# 22 桥接模式

## 合成/聚合复用原则（CARP）

### 问题

#### 对象的继承关系是在编译时就定义好了，所以无法在运行时改变从父类继承的实现。

##### 子类的实现与它的父类有非常紧密的依赖关系，以至于父类实现中的任何变化必然会导致子类发生变化

##### （这原本就是继承带来的好处，把事物共同的地方抽象提取出来，放到父类中，将来需要修改时只需要修改父类即可，这个好处同时也是坏处，在不同的场景下好和坏会相互转化）

##### 什么场景下这个优点会变成缺点呢？

###### 当需要复用子类时，如果继承下来的实现不适合解决新的问题，则父类必须重写或被其它更适合的类替换

####### key word：新的问题

###### 这种依赖关系限制了灵活性并最终限制了复用性（不得不修改父类）

#### 手机品牌与手机软件的问题

##### 手机有不同的品牌，手机上有不同的软件，不同的软件在不同的手机品牌上有不同的实现

##### 继承关系

###### 软件 与 品牌 如果放在一个继承关系中，将来不论是新增加软件或是新增加品牌，都会导致需要增加与软件或品牌类型数量相同的子类

##### 组合关系

###### 品牌 应该包含 软件，可以通过“组合”的关系去除耦合

### 解决方案：尽量使用组合/聚合，尽量不要使用类继承

#### 组合

##### 强的拥有关系，体现严格的部分和整体的关系，部分和整体的生命周期一样

###### 大雁和翅膀

###### 汽车和轮胎

#### 聚合

##### 弱的拥有关系，体现的是A对象可以包含B对象，但B对象不是A对象的一部分

###### 公司和部门

###### 雁群和大雁

### why

#### 优先使用对象的组合/聚合有助于保持每个类被封装，并被集中在单个任务上。这样类和类的继承层次会保持较小规模，并且不太可能增长为不可控制的庞然大物

### 遗留问题

#### 使用继承关系时，不同的手机品牌的软件能够有自定义的实现，而使用组合关系时，却只有一种实现方式，这个软件可能不适用于其它品牌，所以：

##### 在添加一个软件时，还是可能需要添加针对多个不同品牌的软件的类

##### 在添加一个品牌时，还是可能需要为该品牌实现所有软件

#### 手机品牌的例子不好，更好的例子

##### 参考https://www.oodesign.com/bridge-pattern.html中，“数据持久化接口”的抽象与“文件系统持久化”和“数据库持久化”两种实现的分离

##### JDBC API与不同的数据库驱动

## 桥接模式定义

### 将抽象部分与它的实现部分分离，使它们都可以独立地变化

## 概念

### 抽象与实现分离——指的是一个事物能够按照一定的规则分类（派生/抽象），不同的派生类型对于某一种操作有不同的（实现）

## 桥接模式 vs 抽象工厂模式

### 抽象工厂模式中的具体工厂在桥接模式中即具体实现

### 抽象工厂用于对象的创建，通过创建具体工厂，选择具体实现

### 桥接模式通过设置“client”中的“implementor”来选择具体实现

### 抽象工厂偏向于对象的创建（不同类型/不同产品族），桥接模式偏向于对行为的抽象（抽象出来后的行为可能根据另外一个维度的划分有不同的实现）
